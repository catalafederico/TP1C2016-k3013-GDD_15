/* Se inserta el usuario fede, password 1234 */

INSERT INTO GDD_15.USUARIOS(C_USUARIO_NOMBRE,C_PASSWORD)
VALUES ('fede',(SELECT SUBSTRING(master.dbo.fn_varbintohexstr(HASHBYTES('SHA2_256','1234')),3,250) ))
GO

/* Se le asigna el rol cliente al usuario fede */

INSERT INTO GDD_15.ROLES_USUARIOS(N_ID_USUARIO, N_ID_ROL)
SELECT tablaUsuarios.N_ID_USUARIO, tablaRoles.N_ID_ROL FROM GDD_15.USUARIOS tablaUsuarios, GDD_15.ROLES tablaRoles
WHERE tablaRoles.C_ROL = 'Cliente' AND tablaUsuarios.C_USUARIO_NOMBRE = 'fede'
GO

/* Se inserta el usuario ivi, password 1234 */

INSERT INTO GDD_15.USUARIOS(C_USUARIO_NOMBRE,C_PASSWORD)
VALUES ('ivi',(SELECT SUBSTRING(master.dbo.fn_varbintohexstr(HASHBYTES('SHA2_256','1234')),3,250) ))
GO

/* Se le asigna el rol cliente y empresa al usuario ivi */

INSERT INTO GDD_15.ROLES_USUARIOS(N_ID_USUARIO, N_ID_ROL)
SELECT tablaUsuarios.N_ID_USUARIO, tablaRoles.N_ID_ROL FROM GDD_15.USUARIOS tablaUsuarios, GDD_15.ROLES tablaRoles
WHERE tablaRoles.C_ROL != 'Administrativo' AND tablaUsuarios.C_USUARIO_NOMBRE = 'ivi'
GO


/* Tests (consultas) */

SELECT * FROM GDD_15.FUNCIONALIDADES
SELECT * FROM GDD_15.FUNCIONALIDADES_ROLES
SELECT * FROM GDD_15.ROLES
SELECT * FROM GDD_15.USUARIOS
SELECT * FROM GDD_15.ROLES_USUARIOS

SELECT C_PASSWORD FROM GDD_15.USUARIOS WHERE C_USUARIO_NOMBRE = 'admin'

SELECT COUNT(*) FROM GDD_15.ROLES_USUARIOS ROLES
JOIN GDD_15.USUARIOS USUARIOS ON (USUARIOS.N_ID_USUARIO = ROLES.N_ID_USUARIO)
WHERE USUARIOS.C_USUARIO_NOMBRE = 'ivi' AND roles.F_BAJA IS NULL

SELECT R.C_ROL FROM GDD_15.ROLES_USUARIOS RU
JOIN GDD_15.USUARIOS U ON (U.N_ID_USUARIO = RU.N_ID_USUARIO)
JOIN GDD_15.ROLES R ON (R.N_ID_ROL = RU.N_ID_ROL)
WHERE U.C_USUARIO_NOMBRE = 'admin' AND R.F_BAJA IS NULL AND RU.F_BAJA IS NULL
